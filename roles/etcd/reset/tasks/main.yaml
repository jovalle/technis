- name: clear etcd command
  debug:
    msg: ETCDCTL_API=3 etcdctl --endpoints {% for i in groups['etcd'] %}https://{{ hostvars[i]['ansible_' + (default_interface | default('eth0'))]['ipv4']['address'] }}:2379{% if not loop.last %},{% endif %}{% endfor %} --cacert {{ target_dir | default('/etc/etcd/pki') }}/etcd-ca.pem --cert {{ target_dir | default('/etc/etcd/pki') }}/etcd-peer.pem --key {{ target_dir | default('/etc/etcd/pki') }}/etcd-peer-key.pem del "" --from-key=true
  run_once: yes
  delegate_to: "{{ groups['etcd'][0] }}"

- name: clear etcd
  shell: |
    ETCDCTL_API=3 etcdctl --endpoints {% for i in groups['etcd'] %}https://{{ hostvars[i]['ansible_' + (default_interface | default('eth0'))]['ipv4']['address'] }}:2379{% if not loop.last %},{% endif %}{% endfor %} --cacert {{ target_dir | default('/etc/etcd/pki') }}/etcd-ca.pem --cert {{ target_dir | default('/etc/etcd/pki') }}/etcd-peer.pem --key {{ target_dir | default('/etc/etcd/pki') }}/etcd-peer-key.pem del "" --from-key=true
  run_once: yes
  delegate_to: "{{ groups['etcd'][0] }}"
