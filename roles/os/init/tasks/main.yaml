- name: set hostname
  hostname:
    name: "{{ inventory_hostname }}"

- name: update /etc/hostname
  shell: echo "{{ inventory_hostname }}" > /etc/hostname

- name: create .ssh dir if missing
  file:
    path: /root/.ssh
    mode: 0700
    state: directory

- name: create authorized_keys if missing
  file:
    path: /root/.ssh/authorized_keys
    mode: 0600
    state: touch

- name: render SSH authorized_keys
  lineinfile:
    path: /root/.ssh/authorized_keys
    line: "{{ ssh_public_key }}"

- name: render SSH key
  copy:
    dest: /root/.ssh/id_rsa
    content: "{{ ssh_private_key }}"
    mode: 0600

- name: personal touch
  lineinfile:
    path: /root/.bashrc
    line: "{{ item }}"
  with_items:
  - set -o vi
  - export EDITOR=vim
  - alias k=kubectl
