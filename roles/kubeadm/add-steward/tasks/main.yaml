- name: get join command
  command: kubeadm token create --print-join-command
  register: join_token
  delegate_to: "{{ groups['captains'][0] }}"

- name: get join token
  debug:
    msg: "{{ join_token.stdout }}"

- name: enable kubelet service
  systemd:
    name: kubelet
    state: started
    enabled: yes
  register: kubelet

- name: get service facts
  service_facts:
  register: services

- name: kubeadm init
  command: "{{ join_token.stdout }}"
  when:
  - services.ansible_facts.services['kubelet.service'].state == 'stopped'
  - services.ansible_facts.services['kubelet.service'].status == 'enabled'
