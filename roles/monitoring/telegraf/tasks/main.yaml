- name: install telegraf
  apt:
    name: telegraf

- name: render base configuration
  template:
    src: telegraf.conf.j2
    dest: /etc/telegraf/telegraf.conf
  notify: restart telegraf service

- name: ensure plugin path exists
  file:
    path: "{{ telegraf_plugin_path }}"
    state: directory

- name: configure plugins
  include_tasks: configure.yaml
  with_items:
    - "{{ telegraf_plugins }}"