- name: create /etc/kubernetes/admin.conf in k3s
  block:
  - file:
      path: /etc/kubernetes/
      state: directory
  - copy:
      src: /etc/rancher/k3s/k3s.yaml
      dest: /etc/kubernetes/admin.conf
      remote_src: yes
  - replace:
      path: /etc/kubernetes/admin.conf
      regexp: '127.0.0.1'
      replace: 'api.{{ cluster_domain }}'
  when: inventory_hostname in groups['control_plane']