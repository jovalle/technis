- name: stop kubelet
  systemd:
    name: kubelet
    state: stopped
    enabled: no
  ignore_errors: yes

- name: remove CNI files
  file:
    path: '{{ item }}'
    state: absent
  loop:
  - /etc/cni/net.d
  - /opt/cni
  - /var/lib/calico
  - /var/log/calico

- name: clear iptables
  command: '{{ item }}'
  with_items:
  - iptables -F
  - iptables -t nat -F
  - iptables -t mangle -F
  - iptables -X
  - iptables --flush
  ignore_errors: yes

- name: clear ipvsadm
  command: '{{ item }}'
  with_items:
  - ipvsadm --clear
  ignore_errors: yes
  no_log: yes