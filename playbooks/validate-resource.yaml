- name: get desired count of {{ kind }}/{{ name }}
  shell: >
    kubectl -n {{ namespace }} get {{ kind }} {{ name }} -o jsonpath='{.status.{{ "desiredNumberScheduled" if kind == "daemonset" else "replicas" }}}'
  register: desired_count

- name: verify {{ kind }}/{{ name }} ready x {{ desired_count.stdout }}
  shell: >
    kubectl -n {{ namespace }} get {{ kind }} {{ name }} -o jsonpath='{.status.{{ "numberReady" if kind == "daemonset" else "readyReplicas" }}}'
  register: actual_count
  retries: 12
  delay: 10
  until: desired_count.stdout == actual_count.stdout