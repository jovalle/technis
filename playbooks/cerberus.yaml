- hosts: cerberus
  tags:
    - always
  tasks:
    - name: apt upgrade
      apt:
        upgrade: full
        update_cache: yes
        cache_valid_time: 3600
        force_apt_get: true
        autoclean: yes
        autoremove: yes
      register: apt_upgrade
      retries: 5
      until: apt_upgrade is success
    - name: install packages
      package:
        name: "{{ item }}"
        state: present
      with_items:
        - curl
        - git
        - glances
        - hddtemp
        - lm-sensors
        - python3
        - python3-dev
        - python3-jinja2
        - python3-pip
        - python3-psutil
        - python3-setuptools
        - rsync
        - vim

- hosts: cerberus
  tags:
    - zfs
  tasks:
    - name: install zfs
      package:
        name: "{{ item }}"
      with_items:
        - zfsutils-linux
    - name: import all available zpools
      command:
        cmd: zpool import -a -f
        creates: /hulkpool

- import_playbook: nfs.yaml
  tags:
    - nfs

- import_playbook: smb.yaml
  tags:
    - smb

- import_playbook: gpu.yaml
  tags:
    - gpu