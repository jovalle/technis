- hosts: localhost
  vars:
    provisioner: "{{ infrastructure_provisioner | default('vagrant') }}"
  tasks:
    - name: turn it off and on again
      block:
        - import_role:
            name: "{{ provisioner }}/destroy"
        - import_role:
            name: "{{ provisioner }}/up"
      when:
        - infrastructure_provisioner is defined
        - infrastructure_provisioner != 'none'

- hosts: all
  roles:
    - wait-for-server