- name: set labels for {{ node_role }}
  block:

  - name: check labels
    command: kubectl get node {{ node_name }} -o custom-columns=ROLES:.metadata.labels --no-headers
    register: _node
    ignore_errors: yes
    
  - name: set labels
    command: kubectl label node {{ node_name }} node-role.kubernetes.io/{{ node_role }}=
    when: '"node-role.kubernetes.io/{{ node_role }}" not in _node.stdout'
    ignore_errors: yes
